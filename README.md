# Backtest - –°–∏—Å—Ç–µ–º–∞ –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

–ü—Ä–æ–µ–∫—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è Go.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**: –ë–æ–ª–µ–µ 15 –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (RSI, CCI, MACD, —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ –∏ –¥—Ä.)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ü–æ–∏—Å–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–°–±–æ—Ä –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ Tinkoff Invest API
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24+
- –î–æ—Å—Ç—É–ø –∫ Tinkoff Invest API (–¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backtest/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ backtester/          # –û—Å–Ω–æ–≤–Ω–æ–π –±—ç–∫—Ç–µ—Å—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.go         # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ fetcher/            # –°–±–æ—Ä—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îî‚îÄ‚îÄ main.go         # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Tinkoff API
‚îú‚îÄ‚îÄ internal/               # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ backtest.go         # –õ–æ–≥–∏–∫–∞ –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ candle.go           # –†–∞–±–æ—Ç–∞ —Å–æ —Å–≤–µ—á–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ strategy.go         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ strategies/             # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ cci_oscillator.go   # CCI –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ rsi_oscillator.go   # RSI –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ macd.go             # MACD —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ *.json                  # –§–∞–π–ª—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
go build ./...

# –ò–ª–∏ —Å–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
go build -o backtester ./cmd/backtester/
go build -o fetcher ./cmd/fetcher/
```

### 2. –°–±–æ—Ä –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–±—Ä–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:

```bash
# –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ Tinkoff API (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ tmos_big.json)
./fetcher

# –ò–ª–∏ —Å–±–æ—Ä —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
./fetcher -output=my_data.json
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å–±–æ—Ä—â–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º —Ç–æ–∫–µ–Ω Tinkoff Invest API.

### 3. –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ candles.json
./backtester -file candles.json -strategy all

# –ó–∞–ø—É—Å–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ñ–∞–π–ª–µ —Å –¥–∞–Ω–Ω—ã–º–∏
./backtester -file tmos_big.json -strategy all

# –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Å Buy & Hold —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
./backtester -file data.json -strategy all
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ CCI —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
./backtester -file candles.json -strategy cci_oscillator

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RSI —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
./backtester -file candles.json -strategy rsi_oscillator

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MACD —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
./backtester -file candles.json -strategy macd
```

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

- `cci_oscillator` - Commodity Channel Index
- `rsi_oscillator` - Relative Strength Index
- `macd` - Moving Average Convergence Divergence
- `ma_crossover` - –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö
- `stochastic_oscillator` - –°—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä
- `momentum_breakout` - –ü—Ä–æ–±–æ–π –∏–º–ø—É–ª—å—Å–∞
- `elliott_wave_strategy` - –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–æ–ª–Ω –≠–ª–ª–∏–æ—Ç—Ç–∞
- `arima_strategy` - ARIMA –º–æ–¥–µ–ª—å
- `buy_and_hold` - –ü–æ–∫—É–ø–∫–∞ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ (–±–µ–Ω—á–º–∞—Ä–∫)
- –ò –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...

## üìä –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```
====================================================================================================
üìä –°–†–ê–í–ù–ï–ù–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ô
====================================================================================================
–°—Ç—Ä–∞—Ç–µ–≥–∏—è          –ü—Ä–∏–±—ã–ª—å     –°–¥–µ–ª–∫–∏    –§–∏–Ω–∞–ª, $       –í—Ä–µ–º—è      –†–∞–Ω–≥
----------------------------------------------------------------------------------------------------
cci_oscillator     +15.23%     45        $1152.30       1.2s       ü•á 1
rsi_oscillator     +12.87%     38        $1128.70       980ms      ü•à 2
macd               +8.45%      52        $1084.50       1.5s       ü•â 3
ma_crossover       +5.12%      29        $1051.20       890ms      4
buy_and_hold       +3.21%      1         $1032.10       45ms       5
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```
–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã CCI: –ø–µ—Ä–∏–æ–¥=18, –ø–æ–∫—É–ø–∫–∞=-120.0, –ø—Ä–æ–¥–∞–∂–∞=140.0, –ø—Ä–æ—Ñ–∏—Ç=0.1523
–õ—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã RSI: –ø–µ—Ä–∏–æ–¥=14, –ø–æ–∫—É–ø–∫–∞=25.0, –ø—Ä–æ–¥–∞–∂–∞=75.0, –ø—Ä–æ—Ñ–∏—Ç=0.1287
```

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

### backtester

```bash
Usage: ./backtester [options]

Options:
  -file string
        –ü—É—Ç—å –∫ JSON-—Ñ–∞–π–ª—É —Å–æ —Å–≤–µ—á–∞–º–∏ (default "candles.json")
  -strategy string
        –°—Ç—Ä–∞—Ç–µ–≥–∏—è: all (–≤—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏) –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (default "all")
```

### fetcher

```bash
Usage: ./fetcher [options]

Options:
  -output string
        –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (default "tmos_big.json")
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Tinkoff API

–î–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `cmd/fetcher/main.go`:

```go
const (
    API_TOKEN     = "your_tinkoff_api_token"
    INSTRUMENT_ID = "TCS60A101X76"  // FIGI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    INTERVAL      = "CANDLE_INTERVAL_30_MIN"  // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–≤–µ—á–µ–π
    OUTPUT_FILE   = "tmos_big.json"  // –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
)
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å–≤–µ—á–µ–π

- `CANDLE_INTERVAL_1_MIN` - 1 –º–∏–Ω—É—Ç–∞
- `CANDLE_INTERVAL_5_MIN` - 5 –º–∏–Ω—É—Ç
- `CANDLE_INTERVAL_15_MIN` - 15 –º–∏–Ω—É—Ç
- `CANDLE_INTERVAL_30_MIN` - 30 –º–∏–Ω—É—Ç
- `CANDLE_INTERVAL_HOUR` - 1 —á–∞—Å
- `CANDLE_INTERVAL_DAY` - 1 –¥–µ–Ω—å

## üìà –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `strategies/`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Strategy`:
   ```go
   type Strategy interface {
       Name() string
       GenerateSignals(candles []Candle, params StrategyParams) []SignalType
       Optimize(candles []Candle) StrategyParams
   }
   ```
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ `init()`:
   ```go
   func init() {
       internal.RegisterStrategy("my_strategy", &MyStrategy{})
   }
   ```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test ./...
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

```bash
go fmt ./...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
go mod tidy
go mod verify
```

## üìÅ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "candles": [
    {
      "time": "2023-01-01T00:00:00Z",
      "open": {"units": "100", "nano": 0},
      "high": {"units": "105", "nano": 0},
      "low": {"units": "95", "nano": 0},
      "close": {"units": "103", "nano": 0},
      "volume": "1000"
    }
  ]
}
```

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
