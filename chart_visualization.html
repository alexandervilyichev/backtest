<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info-card h3 {
            margin: 0 0 5px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }
        .info-card .value {
            font-size: 1.5em;
            font-weight: bold;
        }
        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
            background-color: #fafafa;
            border-radius: 8px;
            padding: 15px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button:active {
            transform: translateY(0);
        }
        button.active {
            background-color: #764ba2;
        }
        .signal-legend {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background-color: #f5f5f5;
            border-radius: 6px;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .file-selector {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .file-selector-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .file-selector label {
            font-weight: 600;
            color: #333;
        }
        .file-selector select,
        .file-selector input[type="file"] {
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid #ddd;
            font-size: 14px;
        }
        .file-selector select:focus,
        .file-selector input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .signals-table-container {
            margin-top: 30px;
            overflow-x: auto;
        }
        .signals-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .signals-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .signals-table th,
        .signals-table td {
            padding: 12px 15px;
            text-align: left;
        }
        .signals-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .signals-table tbody tr:hover {
            background-color: #f0f0f0;
            cursor: pointer;
        }
        .signal-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.85em;
        }
        .signal-buy {
            background-color: #4CAF50;
            color: white;
        }
        .signal-sell {
            background-color: #f44336;
            color: white;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .table-header h2 {
            margin: 0;
            color: #333;
        }
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        .filter-buttons button {
            padding: 6px 12px;
            font-size: 13px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .stat-card .label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-card .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</h1>

        <div class="file-selector">
            <div class="file-selector-row">
                <label>–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</label>
                <select id="quick-select" onchange="loadQuickFile(this.value)">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª...</option>
                    <option value="tmos_big.json">TMOS Big</option>
                    <option value="tmos.json">TMOS</option>
                    <option value="tgld.json">TGLD</option>
                    <option value="tpay.json">TPAY</option>
                    <option value="tbru.json">TBRU</option>
                    <option value="trur.json">TRUR</option>
                    <option value="tmos_big_buy_and_hold_signals.json">TMOS Big - Buy & Hold</option>
                    <option value="tmos_big_linear_spline_v2_signals.json">TMOS Big - Linear Spline V2</option>
                    <option value="tmos_big_predictive_linear_spline_v2_signals.json">TMOS Big - Predictive Linear Spline V2</option>
                    <option value="tmos_big_predictive_spline_v2_signals.json">TMOS Big - Predictive Spline V2</option>
                </select>
            </div>
            <div class="file-selector-row">
                <label for="file-input">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π —Ñ–∞–π–ª:</label>
                <input type="file" id="file-input" accept=".json">
                <button onclick="loadSelectedFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>

        <div class="info-panel">
            <div class="info-card">
                <h3>–°—Ç—Ä–∞—Ç–µ–≥–∏—è</h3>
                <div class="value" id="strategy-info">-</div>
            </div>
            <div class="info-card">
                <h3>–ü—Ä–∏–±—ã–ª—å</h3>
                <div class="value" id="profit-info">-</div>
            </div>
            <div class="info-card">
                <h3>–¢–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="value" id="data-points-info">-</div>
            </div>
            <div class="info-card">
                <h3>–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤</h3>
                <div class="value" id="signals-count">-</div>
            </div>
        </div>

        <div class="signal-legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4CAF50;"></div>
                <span>–ü–æ–∫—É–ø–∫–∞ (1)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f44336;"></div>
                <span>–ü—Ä–æ–¥–∞–∂–∞ (2)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2196F3;"></div>
                <span>–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</span>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="chart"></canvas>
        </div>

        <div class="controls">
            <button onclick="resetZoom()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±</button>
            <button id="toggle-buy-btn" onclick="toggleBuySignals()">üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–∫—É–ø–∫–∏</button>
            <button id="toggle-sell-btn" onclick="toggleSellSignals()">üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø—Ä–æ–¥–∞–∂–∏</button>
            <button onclick="togglePriceLine()">üìä –°–∫—Ä—ã—Ç—å –ª–∏–Ω–∏—é —Ü–µ–Ω—ã</button>
        </div>

        <div class="signals-table-container">
            <div class="table-header">
                <h2>üìã –î–µ—Ç–∞–ª–∏ —Å–∏–≥–Ω–∞–ª–æ–≤</h2>
                <div class="filter-buttons">
                    <button onclick="filterSignals('all')" class="active" id="filter-all">–í—Å–µ</button>
                    <button onclick="filterSignals('buy')" id="filter-buy">–ü–æ–∫—É–ø–∫–∏</button>
                    <button onclick="filterSignals('sell')" id="filter-sell">–ü—Ä–æ–¥–∞–∂–∏</button>
                </div>
            </div>

            <div class="stats-grid" id="stats-grid"></div>

            <table class="signals-table" id="signals-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                        <th>–¢–∏–ø —Å–∏–≥–Ω–∞–ª–∞</th>
                        <th>–¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è</th>
                        <th>–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</th>
                        <th>–ú–∞–∫—Å–∏–º—É–º</th>
                        <th>–ú–∏–Ω–∏–º—É–º</th>
                        <th>–û–±—ä–µ–º</th>
                    </tr>
                </thead>
                <tbody id="signals-tbody">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let chart;
        let buySignalsVisible = true;
        let sellSignalsVisible = true;
        let priceLineVisible = true;
        let currentData = null;
        let allSignals = [];

        function parseData(data) {
            const candles = [];
            const buySignals = [];
            const sellSignals = [];
            allSignals = [];

            data.candles.forEach((candle, index) => {
                const timestamp = new Date(candle.time).getTime();

                candles.push({
                    x: timestamp,
                    o: candle.open,
                    h: candle.high,
                    l: candle.low,
                    c: candle.close,
                    v: candle.volume
                });

                if (candle.signal === 1) {
                    const signalData = {
                        x: timestamp,
                        y: candle.low * 0.998,
                        price: candle.close,
                        open: candle.open,
                        high: candle.high,
                        low: candle.low,
                        volume: candle.volume,
                        time: candle.time,
                        index: index + 1
                    };
                    buySignals.push(signalData);
                    allSignals.push({ ...signalData, type: 'buy' });
                } else if (candle.signal === 2) {
                    const signalData = {
                        x: timestamp,
                        y: candle.high * 1.002,
                        price: candle.close,
                        open: candle.open,
                        high: candle.high,
                        low: candle.low,
                        volume: candle.volume,
                        time: candle.time,
                        index: index + 1
                    };
                    sellSignals.push(signalData);
                    allSignals.push({ ...signalData, type: 'sell' });
                }
            });

            return { candles, buySignals, sellSignals };
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}.${month}.${year} ${hours}:${minutes}`;
        }

        function updateSignalsTable(filter = 'all') {
            const tbody = document.getElementById('signals-tbody');
            tbody.innerHTML = '';

            let filteredSignals = allSignals;
            if (filter === 'buy') {
                filteredSignals = allSignals.filter(s => s.type === 'buy');
            } else if (filter === 'sell') {
                filteredSignals = allSignals.filter(s => s.type === 'sell');
            }

            if (filteredSignals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">–ù–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
                return;
            }

            filteredSignals.forEach((signal, idx) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${formatDateTime(signal.time)}</td>
                    <td><span class="signal-badge signal-${signal.type}">${signal.type === 'buy' ? '–ü–û–ö–£–ü–ö–ê' : '–ü–†–û–î–ê–ñ–ê'}</span></td>
                    <td>${signal.open.toFixed(4)}</td>
                    <td><strong>${signal.price.toFixed(4)}</strong></td>
                    <td>${signal.high.toFixed(4)}</td>
                    <td>${signal.low.toFixed(4)}</td>
                    <td>${signal.volume.toLocaleString()}</td>
                `;
                row.onclick = () => highlightSignalOnChart(signal.x);
                tbody.appendChild(row);
            });
        }

        function highlightSignalOnChart(timestamp) {
            if (!chart) return;
            
            // Zoom to the signal area
            const timeRange = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds
            chart.zoomScale('x', {
                min: timestamp - timeRange,
                max: timestamp + timeRange
            }, 'default');
        }

        function updateStats() {
            const statsGrid = document.getElementById('stats-grid');
            const buyCount = allSignals.filter(s => s.type === 'buy').length;
            const sellCount = allSignals.filter(s => s.type === 'sell').length;
            
            const buyPrices = allSignals.filter(s => s.type === 'buy').map(s => s.price);
            const sellPrices = allSignals.filter(s => s.type === 'sell').map(s => s.price);
            
            const avgBuyPrice = buyPrices.length > 0 ? (buyPrices.reduce((a, b) => a + b, 0) / buyPrices.length).toFixed(4) : '-';
            const avgSellPrice = sellPrices.length > 0 ? (sellPrices.reduce((a, b) => a + b, 0) / sellPrices.length).toFixed(4) : '-';

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="label">–°–∏–≥–Ω–∞–ª–æ–≤ –ø–æ–∫—É–ø–∫–∏</div>
                    <div class="value" style="color: #4CAF50;">${buyCount}</div>
                </div>
                <div class="stat-card">
                    <div class="label">–°–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–æ–¥–∞–∂–∏</div>
                    <div class="value" style="color: #f44336;">${sellCount}</div>
                </div>
                <div class="stat-card">
                    <div class="label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏</div>
                    <div class="value">${avgBuyPrice}</div>
                </div>
                <div class="stat-card">
                    <div class="label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</div>
                    <div class="value">${avgSellPrice}</div>
                </div>
            `;
        }

        function filterSignals(type) {
            // Update button states
            document.querySelectorAll('.filter-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`filter-${type}`).classList.add('active');
            
            updateSignalsTable(type);
        }

        function createChart(data) {
            currentData = data;
            const ctx = document.getElementById('chart').getContext('2d');

            const { candles, buySignals, sellSignals } = parseData(data);

            // Update info panel
            document.getElementById('strategy-info').textContent = data.strategy || '-';
            document.getElementById('profit-info').textContent = data.profit ? `${(data.profit * 100).toFixed(2)}%` : '-';
            document.getElementById('data-points-info').textContent = candles.length.toLocaleString();
            document.getElementById('signals-count').textContent = (buySignals.length + sellSignals.length).toLocaleString();

            // Update signals table
            updateSignalsTable();
            updateStats();

            // Create price line data
            const priceData = candles.map(c => ({
                x: c.x,
                y: c.c
            }));

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                data: {
                    datasets: [{
                        label: '–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è',
                        data: priceData,
                        type: 'line',
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        pointRadius: 0,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        order: 3
                    }, {
                        label: '–°–∏–≥–Ω–∞–ª—ã –ø–æ–∫—É–ø–∫–∏',
                        data: buySignals,
                        type: 'scatter',
                        backgroundColor: '#4CAF50',
                        borderColor: '#2E7D32',
                        borderWidth: 2,
                        pointStyle: 'triangle',
                        pointRadius: 10,
                        rotation: 0,
                        showLine: false,
                        order: 1
                    }, {
                        label: '–°–∏–≥–Ω–∞–ª—ã –ø—Ä–æ–¥–∞–∂–∏',
                        data: sellSignals,
                        type: 'scatter',
                        backgroundColor: '#f44336',
                        borderColor: '#C62828',
                        borderWidth: 2,
                        pointStyle: 'triangle',
                        pointRadius: 10,
                        rotation: 180,
                        showLine: false,
                        order: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'nearest',
                        intersect: false,
                        axis: 'x'
                    },
                    plugins: {
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'x'
                            },
                            zoom: {
                                wheel: {
                                    enabled: true
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            callbacks: {
                                title: function(context) {
                                    const data = context[0].raw;
                                    if (data.time) {
                                        return formatDateTime(data.time);
                                    }
                                    return new Date(data.x).toLocaleString('ru-RU');
                                },
                                label: function(context) {
                                    const data = context.raw;
                                    const lines = [];
                                    
                                    if (context.datasetIndex === 0) {
                                        lines.push(`–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: ${data.y.toFixed(4)}`);
                                    } else if (context.datasetIndex === 1) {
                                        lines.push('üü¢ –°–ò–ì–ù–ê–õ –ü–û–ö–£–ü–ö–ò');
                                        lines.push(`–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: ${data.price.toFixed(4)}`);
                                        lines.push(`–û—Ç–∫—Ä—ã—Ç–∏–µ: ${data.open.toFixed(4)}`);
                                        lines.push(`–ú–∞–∫—Å–∏–º—É–º: ${data.high.toFixed(4)}`);
                                        lines.push(`–ú–∏–Ω–∏–º—É–º: ${data.low.toFixed(4)}`);
                                        lines.push(`–û–±—ä–µ–º: ${data.volume.toLocaleString()}`);
                                    } else if (context.datasetIndex === 2) {
                                        lines.push('üî¥ –°–ò–ì–ù–ê–õ –ü–†–û–î–ê–ñ–ò');
                                        lines.push(`–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: ${data.price.toFixed(4)}`);
                                        lines.push(`–û—Ç–∫—Ä—ã—Ç–∏–µ: ${data.open.toFixed(4)}`);
                                        lines.push(`–ú–∞–∫—Å–∏–º—É–º: ${data.high.toFixed(4)}`);
                                        lines.push(`–ú–∏–Ω–∏–º—É–º: ${data.low.toFixed(4)}`);
                                        lines.push(`–û–±—ä–µ–º: ${data.volume.toLocaleString()}`);
                                    }
                                    
                                    return lines;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                displayFormats: {
                                    hour: 'dd.MM HH:mm',
                                    day: 'dd.MM.yyyy',
                                    week: 'dd.MM.yyyy',
                                    month: 'MM.yyyy'
                                },
                                tooltipFormat: 'dd.MM.yyyy HH:mm'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '–¶–µ–Ω–∞',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(4);
                                },
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function resetZoom() {
            if (chart) {
                chart.resetZoom();
            }
        }

        function toggleBuySignals() {
            if (!chart) return;
            buySignalsVisible = !buySignalsVisible;
            chart.data.datasets[1].hidden = !buySignalsVisible;
            chart.update();
            
            const btn = document.getElementById('toggle-buy-btn');
            btn.textContent = buySignalsVisible ? 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø–æ–∫—É–ø–∫–∏' : 'üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–∫—É–ø–∫–∏';
        }

        function toggleSellSignals() {
            if (!chart) return;
            sellSignalsVisible = !sellSignalsVisible;
            chart.data.datasets[2].hidden = !sellSignalsVisible;
            chart.update();
            
            const btn = document.getElementById('toggle-sell-btn');
            btn.textContent = sellSignalsVisible ? 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å –ø—Ä–æ–¥–∞–∂–∏' : 'üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏';
        }

        function togglePriceLine() {
            if (!chart) return;
            priceLineVisible = !priceLineVisible;
            chart.data.datasets[0].hidden = !priceLineVisible;
            chart.update();
            
            event.target.textContent = priceLineVisible ? 'üìä –°–∫—Ä—ã—Ç—å –ª–∏–Ω–∏—é —Ü–µ–Ω—ã' : 'üìä –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏–Ω–∏—é —Ü–µ–Ω—ã';
        }

        async function loadSelectedFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];

            if (!file) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            try {
                const data = await readFileAsJson(file);
                if (data && data.candles && Array.isArray(data.candles)) {
                    createChart(data);
                    document.getElementById('quick-select').value = '';
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON —Ñ–∞–π–ª —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏.');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
            }
        }

        function readFileAsJson(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        resolve(data);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        async function loadQuickFile(filename) {
            if (!filename) return;

            try {
                const response = await fetch(`./${filename}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (data && data.candles && Array.isArray(data.candles)) {
                    createChart(data);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º JSON —Ñ–∞–π–ª–æ–º —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏.');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ "${filename}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.`);
            }
        }

        // Initialize with sample data
        function loadSampleData() {
            const sampleData = {
                "strategy": "–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏",
                "profit": 0.0,
                "candles": [
                    {"time": "2025-08-01T10:00:00Z", "open": 6.36, "high": 6.36, "low": 6.34, "close": 6.34, "volume": 630323, "signal": 0},
                    {"time": "2025-08-01T10:30:00Z", "open": 6.36, "high": 6.36, "low": 6.34, "close": 6.35, "volume": 613366, "signal": 0},
                    {"time": "2025-08-06T14:30:00Z", "open": 6.4, "high": 6.4, "low": 6.38, "close": 6.39, "volume": 864395, "signal": 1},
                    {"time": "2025-08-07T14:30:00Z", "open": 6.42, "high": 6.45, "low": 6.40, "close": 6.44, "volume": 920000, "signal": 2}
                ]
            };
            createChart(sampleData);
        }

        // Try to load default file on page load
        (async () => {
            const defaultFile = 'tmos_big.json';
            try {
                const response = await fetch(`./${defaultFile}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.candles && Array.isArray(data.candles)) {
                        createChart(data);
                        document.getElementById('quick-select').value = defaultFile;
                        return;
                    }
                }
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            }
            
            // Fallback to sample data
            loadSampleData();
        })();
    </script>
</body>
</html>
